<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartomancie √âl√©gante</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-gradient: linear-gradient(170deg, #f3f5f8 0%, #d8dde4 100%);
            --text-color: #3d475d;
            --text-color-light: #7a86a0;
            --accent-color: #6D5BBA;
            --accent-color-light: #A89DDF;
            --red-color: #E96D7F;
            --green-color: #5FAD56;
            --shadow-light: #fafbff;
            --shadow-dark: #bec8d6;
            --neumorphic-shadow: 6px 6px 14px var(--shadow-dark), -6px -6px 14px var(--shadow-light);
            --neumorphic-shadow-inset: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
        }

        body {
            font-family: 'Crimson Text', serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.8;
            font-weight: 400;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 25px 20px; }
        .header { text-align: center; padding: 40px 0; margin-bottom: 40px; }
        .header h1 {
            font-family: 'Cinzel', serif; font-size: 3em; font-weight: 700;
            color: var(--text-color); margin-bottom: 8px; letter-spacing: 1px;
        }
        .header p { font-size: 1.3em; color: var(--text-color-light); font-style: italic; }

        .nav-tabs { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom: 40px; }
        .nav-tab {
            font-family: 'Cinzel', serif; padding: 15px 30px; border-radius: 20px;
            background: #e7ebee; box-shadow: var(--neumorphic-shadow); color: var(--text-color-light);
            cursor: pointer; transition: all 0.2s ease-out; font-size: 1em; font-weight: 600; border: none;
        }
        .nav-tab:hover { color: var(--text-color); }
        .nav-tab.active { box-shadow: var(--neumorphic-shadow-inset); color: var(--accent-color); }

        .section { display: none; background: transparent; padding: 20px 0; }
        .section.active { display: block; animation: fadeInSection 0.5s ease-out; }
        @keyframes fadeInSection { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title {
            font-family: 'Cinzel', serif; font-size: 2.2em; color: var(--text-color);
            text-align: center; margin-bottom: 15px; font-weight: 600;
        }
        .section-intro {
            text-align: center; margin-bottom: 40px; font-size: 1.1em; color: var(--text-color-light);
            max-width: 700px; margin-left: auto; margin-right: auto;
        }
        
        .card-display { display: flex; justify-content: center; align-items: center; margin: 30px 0; min-height: 420px; }
        .playing-card {
            width: 280px; height: 400px; background-color: #e7ebee;
            border-radius: 25px; box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
            cursor: pointer; transition: all 0.3s ease-out; border: 5px solid #fff;
            background-size: cover; background-position: center;
        }
        .playing-card:hover {
            transform: scale(1.05);
            box-shadow: 15px 15px 30px var(--shadow-dark), -15px -15px 30px var(--shadow-light);
        }

        .card-meaning-panel {
            background-color: #e7ebee; box-shadow: var(--neumorphic-shadow-inset); border-radius: 20px;
            padding: 30px; margin: 25px auto; max-width: 700px; transition: all 0.4s ease-out;
            overflow: hidden; max-height: 0; opacity: 0; margin-top: 0; padding-top: 0; padding-bottom: 0;
        }
        .card-meaning-panel.visible { max-height: 1000px; opacity: 1; margin-top: 25px; padding: 30px; }
        .card-meaning-panel h3 {
            font-family: 'Cinzel', serif; color: var(--accent-color);
            font-size: 1.4em; margin-bottom: 12px; font-weight: 600;
        }
        .card-meaning-panel p { font-size: 1.1em; color: var(--text-color-light); }
        
        .btn {
            padding: 18px 35px; background: var(--accent-color); color: #fff;
            border: none; border-radius: 15px; font-family: 'Cinzel', serif; font-size: 1em; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease-out; text-decoration: none;
            display: inline-block; box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
        }
        .btn:hover:not(.disabled) { transform: translateY(-2px); opacity: 0.9; }
        .btn:active:not(:disabled) { box-shadow: var(--neumorphic-shadow-inset); }
        .btn.secondary { background: #e7ebee; color: var(--text-color-light); box-shadow: var(--neumorphic-shadow); }
        .btn.secondary:hover:not(:disabled) { color: var(--accent-color); }
        .btn.disabled { cursor: not-allowed; opacity: 0.6; box-shadow: var(--neumorphic-shadow-inset); }
        
        .buttons-group { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 35px 0; flex-wrap: wrap; }
        
        .notes-section { margin-top: 40px; }
        .notes-section h3 {
            font-family: 'Cinzel', serif; font-size: 1.3em;
            text-align: center; font-weight: 600; margin-bottom: 20px;
        }
        .notes-textarea {
            width: 100%; min-height: 120px; background: #e7ebee; box-shadow: var(--neumorphic-shadow-inset);
            border: none; border-radius: 15px; padding: 20px; color: var(--text-color);
            font-family: inherit; font-size: 1em; resize: vertical;
        }
        .notes-textarea:focus { outline: none; box-shadow: var(--neumorphic-shadow-inset), 0 0 0 2px var(--accent-color-light); }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 229, 236, 0.7); z-index: 1000; backdrop-filter: blur(5px);
            align-items: center; justify-content: center; animation: fadeInSection 0.3s ease-out;
        }
        .modal-content {
            position: relative; background: #e7ebee; border-radius: 25px;
            padding: 30px 35px; max-width: 650px; width: 90%;
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
            max-height: 90vh; overflow-y: auto;
        }
        .close-modal {
            position: absolute; top: 20px; right: 25px; font-size: 1.8em;
            cursor: pointer; color: var(--text-color-light); transition: all 0.25s ease;
        }
        .close-modal:hover { color: var(--accent-color); }

        .card-library-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 25px; margin: 30px 0;
        }
        .library-card { 
            aspect-ratio: 5/7; border-radius: 15px; cursor: pointer; transition: all 0.3s ease-out;
            box-shadow: var(--neumorphic-shadow); background-size: cover; background-position: center;
        }
        .library-card:hover {
            transform: scale(1.07) translateY(-5px);
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
        }
        
        .tirage-selection-grid { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .tirage-select-btn { width: 100%; max-width: 450px; text-align: center; }
        .tirage-select-btn h3 { font-size: 1.1em; }
        .tirage-select-btn p { font-family: 'Crimson Text', serif; font-size: 0.9em; margin-top: 5px; color: var(--text-color-light); }
        
        .cards-spread-display-area { display: flex; justify-content: center; align-items: flex-start; flex-wrap: wrap; gap: 20px; margin: 35px 0; padding-bottom: 20px; min-height: 180px; }
        .spread-card-item { display: flex; flex-direction: column; align-items: center; transition: transform 0.3s ease-out; }
        .spread-card-item:hover { transform: scale(1.05); z-index: 10; }
        .drawn-card-display { 
            width: 120px; height: 168px; border-radius: 15px; 
            box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
            background-size: cover; background-position: center; transition: all 0.3s ease-out;
            border: 3px solid #fff;
        }
        .card-position-label {
            margin-top: 12px; font-size: 0.9em; color: var(--text-color-light);
            text-align: center; width: 100%; font-weight: 600;
        }
        #tirage-interpretation-area { max-height: unset !important; opacity: 1 !important; display:none; }
        
        /* --- STYLES SP√âCIFIQUES AU CENTRE D'ENTRA√éNEMENT --- */
        #entrainement-hub .btn, #entrainement-hub .tirage-select-btn { width: 100%; max-width: 450px; text-align: center; }
        #entrainement-hub h3 { margin: 0; font-size: 1.1em; }
        #entrainement-hub p { font-size: 0.9em; font-family: 'Crimson Text', serif; margin-top: 5px; color: var(--text-color-light); }
        
        .game-board { display: none; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
        .game-board.active { display: flex; animation: fadeInSection 0.4s; }
        .game-card-display { width: 180px; height: 252px; border-radius: 20px; box-shadow: var(--neumorphic-shadow); background-size: cover; background-position: center; }
        
        .game-question { font-size: 1.2em; text-align: center; margin: 10px 0; max-width: 600px; }
        .game-options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 600px; }
        .game-options-list { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 600px; }
        .game-option-btn { width: 100%; font-size: 1em; padding: 20px; }
        .quiz-option {
            padding: 20px; background: #e7ebee; box-shadow: var(--neumorphic-shadow);
            border-radius: 15px; cursor: pointer; transition: all 0.2s ease-out;
            font-size: 1em; text-align: left;
        }
        .quiz-option.disabled { cursor: not-allowed; opacity: 0.7; }
        .quiz-option.correct { box-shadow: var(--neumorphic-shadow-inset); color: var(--green-color); font-weight: 600; }
        .quiz-option.incorrect { box-shadow: var(--neumorphic-shadow-inset); color: var(--red-color); }
        .quiz-option:hover:not(.disabled) { box-shadow: var(--neumorphic-shadow-inset); color: var(--accent-color); }

        .keyword-input {
            width: 100%; max-width: 500px; padding: 18px; font-size: 1em;
            border: none; border-radius: 15px; background: #e7ebee;
            box-shadow: var(--neumorphic-shadow-inset); text-align: center; font-family: 'Crimson Text', serif;
        }
        .keyword-input:focus { outline: none; box-shadow: var(--neumorphic-shadow-inset), 0 0 0 2px var(--accent-color-light); }
        
        .family-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 320px; margin-bottom: 20px; }
        .family-card {
            aspect-ratio: 5/7; border-radius: 15px; background-size: cover;
            border: 3px solid transparent; box-shadow: var(--neumorphic-shadow); cursor: pointer; transition: all 0.2s ease;
        }
        .family-card.selected { border-color: var(--accent-color); box-shadow: 0 0 15px var(--accent-color-light); transform: scale(1.05); }
        .family-card.matched { opacity: 0.4; cursor: default; }
        
        .family-meanings-list .quiz-option { margin-bottom: 10px; cursor: pointer; }
        .family-meanings-list .quiz-option.selected { box-shadow: var(--neumorphic-shadow-inset); color: var(--accent-color); }
        .family-meanings-list .quiz-option.matched { box-shadow: var(--neumorphic-shadow-inset); background-color: #d1d9e6; opacity: 0.5; cursor: default; }

        .sprint-timer { font-family: 'Cinzel'; font-size: 1.5em; color: var(--accent-color); }
        .sprint-score { font-family: 'Cinzel'; font-size: 1.2em; color: var(--text-color-light); }
        
        .game-feedback { min-height: 1.5em; font-weight: 600; font-size: 1.1em; margin-top: 15px; text-align: center; }
        .game-feedback.correct { color: var(--green-color); }
        .game-feedback.incorrect { color: var(--red-color); }

        @media (max-width: 768px) {
            .header h1 { font-size: 2.2em; } .header p { font-size: 1.1em; }
            .section { padding: 25px 0; } .nav-tab { padding: 12px 20px; font-size: 0.9em; }
            .playing-card { width: 240px; height: 342px; }
            .card-library-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cartomancie √âl√©gante</h1>
            <p>D√©couvrez les arcanes, ma√Ætrisez votre intuition</p>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showSection('apprentissage')">üìö Apprentissage</div>
            <div class="nav-tab" onclick="showSection('entrainement')">üéØ Entra√Ænement</div>
            <div class="nav-tab" onclick="showSection('tirage')">üîÆ Tirages</div>
            <div class="nav-tab" onclick="showSection('bibliotheque')">üìñ Biblioth√®que</div>
        </div>

        <div id="apprentissage" class="section active">
            <h2 class="section-title">Carte du Jour</h2>
            <p class="section-intro">Cliquez sur le bouton pour tirer une carte, puis sur la carte elle-m√™me pour r√©v√©ler sa signification.</p>
            <div class="buttons-group" style="margin-bottom: 30px;"><button class="btn" onclick="newFlashcard()">Tirer une Nouvelle Carte</button></div>
            <div class="card-display"><div class="playing-card" id="flashcard" onclick="toggleMeaning()"></div></div>
            <div class="card-meaning-panel" id="flashcard-meaning-details">
                <h3 id="flashcard-meaning-name"></h3>
                <p id="flashcard-meaning-text"></p>
            </div>
            <div class="notes-section">
                <h3>Notes Personnelles</h3>
                <textarea class="notes-textarea" id="personal-notes" placeholder="Vos r√©flexions sur cette carte..."></textarea>
                <div class="buttons-group"><button class="btn secondary" onclick="saveNotes()">Sauvegarder les Notes</button></div>
            </div>
        </div>

        <div id="entrainement" class="section">
            <h2 class="section-title">Centre d'Entra√Ænement</h2>
            <p class="section-intro">Choisissez un mode de jeu pour approfondir votre connaissance des cartes de mani√®re ludique et efficace.</p>

            <div id="entrainement-hub">
                <div class="buttons-group" style="flex-direction: column;">
                    <button class="btn tirage-select-btn" onclick="startGame('keyword')"><h3>Jeu des Mots-Cl√©s</h3><p>Retrouvez l'essence d'une carte.</p></button>
                    <button class="btn tirage-select-btn" onclick="startGame('thematic')"><h3>Tri Th√©matique</h3><p>Associez une carte √† son th√®me principal.</p></button>
                    <button class="btn tirage-select-btn" onclick="startGame('sprint')"><h3>Sprint Divinatoire</h3><p>Identifiez la polarit√© d'une carte le plus vite possible.</p></button>
                    <button class="btn tirage-select-btn" onclick="startGame('family')"><h3>Jeu des Familles</h3><p>Comparez les cartes de m√™me valeur.</p></button>
                    <button class="btn tirage-select-btn" onclick="startGame('classic')"><h3>Flash Quiz Classique</h3><p>R√©pondez √† des QCM traditionnels.</p></button>
                </div>
            </div>

            <div id="game-area" class="game-board">
                <!-- Le contenu dynamique du jeu sera inject√© ici -->
            </div>
        </div>

        <div id="tirage" class="section">
            <h2 class="section-title">Tirages Divinatoires</h2>
            <p class="section-intro">S√©lectionnez un type de tirage pour recevoir une guidance.</p>
            <div class="tirage-container">
                <div class="tirage-selection-grid" id="tirage-selection-grid"></div>
                <div class="cards-spread-display-area" id="cards-spread-area"></div>
                <div id="tirage-interpretation-area" class="card-meaning-panel">
                    <h3>Interpr√©tation du Tirage</h3>
                    <div id="tirage-interpretation-text"></div>
                    <div id="tirage-interpretation-synthesis" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #d1d9e6;"><h4 style="font-family:'Cinzel'; color:var(--accent-color);">Synth√®se :</h4><p id="tirage-synthesis-text"></p></div>
                </div>
                <div class="buttons-group" id="tirage-buttons-group"><button class="btn secondary" onclick="clearTirage()" style="display:none;" id="clear-tirage-btn">Nouveau Tirage</button></div>
            </div>
        </div>

        <div id="bibliotheque" class="section">
            <h2 class="section-title">Biblioth√®que des Arcanes</h2>
            <p class="section-intro">Consultez toutes les cartes, leurs significations et vos notes personnelles.</p>
            <div class="card-library-grid" id="card-library-grid"></div>
        </div>

    </div>

    <div id="card-detail-modal" class="modal" onclick="closeModalOnClickOutside(event)">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">√ó</span>
            <div id="modal-card-display-area"><div class="playing-card" id="modal-playing-card" style="cursor:default; box-shadow:none; border: none;"></div></div>
            <h3 id="modal-card-name" class="section-title" style="font-size: 1.8em;"></h3>
            <p id="modal-card-meaning" style="color: var(--text-color-light);"></p>
            <hr style="border:none; height:1px; background: #e7ebee; box-shadow: var(--neumorphic-shadow-inset); margin:20px 0;">
            <h4 id="modal-card-notes-title" style="font-family: 'Cinzel', serif; color: var(--accent-color); font-weight: 600;">Notes Personnelles :</h4>
            <p id="modal-card-notes" style="color: var(--text-color-light);"></p>
        </div>
    </div>
    
    <div id="toast-notification" class="toast" style="background-color: var(--accent-color); color: #fff; border-radius: 10px; box-shadow: var(--neumorphic-shadow);"></div>

<script>
    // --- CONFIGURATION GLOBALE ---
    const SUITS = {
        CLUBS: { symbol: '‚ô£', name: 'Tr√®fles' }, HEARTS: { symbol: '‚ô•', name: 'C≈ìurs' },
        SPADES: { symbol: '‚ô†', name: 'Piques' }, DIAMONDS: { symbol: '‚ô¶', name: 'Carreaux' }
    };
    const VALUES = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'V', 'D', 'R'];
    const VALUE_NAMES = { 'A': 'As', 'R': 'Roi', 'D': 'Dame', 'V': 'Valet' };

    // --- DONN√âES DE JEU (sans les images, elles seront g√©n√©r√©es) ---
    const cardData = {
        hearts: { name: 'C≈ìurs', cards: {
            'As de C≈ìur': { meaning: "Cette carte est l'une des meilleures du jeu, elle annonce un grand bonheur affectif, une joie intense et durable. Une rencontre amoureuse tr√®s importante qui bouleversera votre vie. Pour un couple d√©j√† existant, elle annonce un renforcement des liens, un second souffle. Elle peut √©galement annoncer une naissance ou un d√©m√©nagement.", keywords: ["amour", "bonheur", "joie", "naissance", "rencontre"], theme: "Relationnel", vibe: "positive" },
            'Roi de C≈ìur': { meaning: "Repr√©sente un homme bon, g√©n√©reux et sinc√®re. Il peut repr√©senter le consultant lui-m√™me, le mari, le p√®re ou un ami tr√®s proche. C'est un homme sur qui on peut compter, il est de bon conseil et apporte son soutien. Ses sentiments sont toujours sinc√®res et loyaux.", keywords: ["homme", "sinc√®re", "g√©n√©reux", "protection"], theme: "Personnage", vibe: "positive" },
            'Dame de C≈ìur': { meaning: "Repr√©sente une femme bonne, g√©n√©reuse et sinc√®re. Elle peut repr√©senter la consultante elle-m√™me, la femme, la m√®re ou une amie tr√®s proche. Ses sentiments sont toujours sinc√®res et loyaux. C'est une femme sur qui on peut compter.", keywords: ["femme", "sinc√®re", "aimante", "amie"], theme: "Personnage", vibe: "positive" },
            'Valet de C≈ìur': { meaning: "Repr√©sente un jeune homme blond, il est doux, r√™veur et romantique. Il peut repr√©senter un adolescent, un jeune adulte ou un enfant. Cette carte annonce des nouvelles ou une lettre d'amour. Elle annonce √©galement une amourette, un flirt, un amour naissant.", keywords: ["jeune homme", "amour naissant", "lettre", "flirt"], theme: "Relationnel", vibe: "positive" },
            '10 de C≈ìur': { meaning: "Annonce la joie, le bonheur, la r√©ussite sentimentale. Pour un couple, elle annonce la solidit√© des liens, une famille unie. Elle peut √©galement annoncer une c√©l√©bration, une f√™te, un mariage, des fian√ßailles. C'est une carte tr√®s positive.", keywords: ["bonheur", "famille", "r√©ussite", "f√™te", "mariage"], theme: "√âv√©nement", vibe: "positive" },
            '9 de C≈ìur': { meaning: "Annonce la r√©ussite, le succ√®s et la joie. Le consultant verra l'un de ses souhaits se r√©aliser. Cette carte est tr√®s b√©n√©fique dans le domaine sentimental et annonce une relation durable et sinc√®re. C'est une carte tr√®s positive.", keywords: ["r√©ussite", "souhait", "joie", "succ√®s"], theme: "√âv√©nement", vibe: "positive" },
            '8 de C≈ìur': { meaning: "Repr√©sente une jeune fille blonde. Cette carte annonce des sentiments sinc√®res et partag√©s, une d√©claration d'amour. Elle peut √©galement repr√©senter un flirt, une amourette, une relation naissante.", keywords: ["jeune fille", "d√©claration", "sentiments", "flirt"], theme: "Relationnel", vibe: "positive" },
            '7 de C≈ìur': { meaning: "Annonce une satisfaction dans le domaine sentimental ou amical. Elle repr√©sente les pens√©es affectueuses, une relation harmonieuse et √©panouie. Les liens se resserrent.", keywords: ["satisfaction", "harmonie", "pens√©es", "amical"], theme: "Relationnel", vibe: "positive" },
            '6 de C≈ìur': { meaning: "√âvoque la nostalgie du pass√©, on repense √† un amour perdu, √† un √™tre cher. Cette carte peut aussi annoncer le retour d'un amour du pass√©. Elle repr√©sente √©galement les souvenirs de l'enfance.", keywords: ["nostalgie", "souvenir", "pass√©", "enfance"], theme: "√âtat d'esprit", vibe: "neutre" },
            '5 de C≈ìur': { meaning: "Annonce un cadeau, une surprise, une invitation. Le consultant va recevoir une nouvelle inattendue qui lui apportera beaucoup de joie.", keywords: ["cadeau", "surprise", "invitation", "joie"], theme: "√âv√©nement", vibe: "positive" },
            '4 de C≈ìur': { meaning: "Annonce un chagrin d'amour, une d√©ception, des soucis au sein du couple. Le consultant devra se m√©fier des personnes qui l'entourent, il pourrait √™tre d√©√ßu par une personne de son entourage. Cette carte invite √† la prudence et √† la m√©fiance.", keywords: ["chagrin", "d√©ception", "m√©fiance", "prudence"], theme: "Relationnel", vibe: "negative" },
            '3 de C≈ìur': { meaning: "Annonce un amour naissant, une nouvelle rencontre, un flirt, une idylle. Cette carte est de courte dur√©e mais elle est tr√®s positive.", keywords: ["idylle", "flirt", "rencontre", "amour naissant"], theme: "Relationnel", vibe: "positive" },
            '2 de C≈ìur': { meaning: "Annonce l'union, l'association. Elle est tr√®s b√©n√©fique dans le domaine sentimental et annonce un engagement, un mariage. Dans le domaine professionnel, elle annonce la signature d'un contrat, une nouvelle collaboration.", keywords: ["union", "mariage", "association", "collaboration"], theme: "Relationnel", vibe: "positive" }
        }},
        diamonds: { name: 'Carreaux', cards: {
            'As de Carreau': { meaning: "Annonce des nouvelles, une lettre, un message important. Dans le domaine professionnel, il peut annoncer la signature d'un contrat, une proposition. Le consultant devra entreprendre des d√©marches afin de voir son projet se r√©aliser.", keywords: ["nouvelles", "contrat", "lettre", "d√©marche"], theme: "Professionnel", vibe: "neutre" },
            'Roi de Carreau': { meaning: "Est un homme d'un certain √¢ge, il peut √™tre √©tranger ou du moins venir de loin. C'est un homme influent, un homme de pouvoir. Il peut repr√©senter un homme d'affaires, un banquier ou une profession lib√©rale. C'est un appui important dans le domaine professionnel.", keywords: ["homme", "affaires", "pouvoir", "√©tranger", "appui"], theme: "Personnage", vibe: "neutre" },
            'Dame de Carreau': { meaning: "Est une femme d'un certain √¢ge, elle peut √™tre √©trang√®re ou venir de loin. C'est une femme calculatrice, int√©ress√©e et tr√®s port√©e sur l'argent. Dans un jeu, elle repr√©sente une rivale, elle est m√©disante et hypocrite. Le consultant devra se m√©fier de cette femme.", keywords: ["femme", "rivale", "m√©disance", "argent"], theme: "Personnage", vibe: "negative" },
            'Valet de Carreau': { meaning: "Repr√©sente un jeune homme, il est souvent blond. Il peut annoncer des nouvelles, un changement, un voyage, un d√©placement. Le consultant peut s'attendre √† un changement dans sa vie.", keywords: ["jeune homme", "voyage", "nouvelles", "changement"], theme: "√âv√©nement", vibe: "neutre" },
            '10 de Carreau': { meaning: "Annonce un voyage, un d√©placement, un d√©m√©nagement. Cette carte est tr√®s positive dans le domaine financier, elle peut annoncer une rentr√©e d'argent, un h√©ritage, un gain important. C'est la carte de la r√©ussite.", keywords: ["voyage", "argent", "gain", "r√©ussite", "d√©m√©nagement"], theme: "Financier", vibe: "positive" },
            '9 de Carreau': { meaning: "Annonce un retard, un impr√©vu, une contrari√©t√©. Le consultant devra faire face √† des obstacles qui viendront perturber ses projets. Cette carte annonce √©galement une opposition, un √©chec passager.", keywords: ["retard", "obstacle", "contrari√©t√©", "√©chec"], theme: "Difficult√©", vibe: "negative" },
            '8 de Carreau': { meaning: "Annonce des d√©marches, des n√©gociations, un rendez-vous. Le consultant devra se d√©placer, il peut √©galement recevoir une visite. Cette carte est tr√®s positive pour les affaires.", keywords: ["d√©marche", "n√©gociation", "rendez-vous", "visite"], theme: "Professionnel", vibe: "positive" },
            '7 de Carreau': { meaning: "Annonce le succ√®s, l'aboutissement, la satisfaction. C'est une carte tr√®s positive. Elle peut aussi repr√©senter la col√®re, une dispute. Le consultant devra rester prudent.", keywords: ["succ√®s", "satisfaction", "col√®re", "dispute"], theme: "√âv√©nement", vibe: "mixte" },
            '6 de Carreau': { meaning: "Annonce que les d√©marches entreprises par le consultant s'av√®rent difficiles. Il devra faire preuve de patience et de pers√©v√©rance pour voir son projet se r√©aliser.", keywords: ["difficult√©", "patience", "pers√©v√©rance", "d√©marche"], theme: "Difficult√©", vibe: "negative" },
            '5 de Carreau': { meaning: "Annonce des nouvelles inattendues. Elles peuvent concerner les finances, la famille ou le domaine professionnel. Le consultant devra rester attentif √† ce qui se passe autour de lui.", keywords: ["nouvelles", "inattendu", "finances", "famille"], theme: "√âv√©nement", vibe: "neutre" },
            '4 de Carreau': { meaning: "Annonce une r√©ussite professionnelle, une signature de contrat, l'aboutissement d'un projet. Cette carte est tr√®s positive pour tout ce qui concerne les affaires.", keywords: ["r√©ussite", "contrat", "projet", "affaires"], theme: "Professionnel", vibe: "positive" },
            '3 de Carreau': { meaning: "Annonce des difficult√©s passag√®res, un petit tracas sans gravit√©. Le consultant devra faire face √† des petits soucis mais qui ne dureront pas dans le temps.", keywords: ["difficult√©", "passager", "tracas", "souci"], theme: "Difficult√©", vibe: "negative" },
            '2 de Carreau': { meaning: "Annonce une association, un duo, une nouvelle collaboration. Cette carte peut √©galement annoncer des difficult√©s financi√®res, le consultant devra √™tre prudent et ne pas d√©penser son argent inutilement.", keywords: ["association", "collaboration", "duo", "prudence"], theme: "Professionnel", vibe: "mixte" }
        }},
        spades: { name: 'Piques', cards: { 
            'As de Pique': { meaning: "Est une carte tr√®s forte, elle annonce une transformation, un changement radical, une rupture, la fin d'une situation. Elle repr√©sente un acte important, une d√©cision √† prendre.", keywords: ["transformation", "rupture", "d√©cision", "fin"], theme: "Changement Radical", vibe: "negative" },
            'Roi de Pique': { meaning: "Est un homme de loi, un homme de justice. Il peut repr√©senter un avocat, un notaire, un juge. Il peut √©galement repr√©senter un m√©decin. C'est un homme veuf ou divorc√©. Cette carte annonce un proc√®s, des litiges, des conflits.", keywords: ["justice", "homme de loi", "proc√®s", "m√©decin"], theme: "Personnage", vibe: "negative" },
            'Dame de Pique': { meaning: "Est une femme seule, veuve ou divorc√©e, elle peut aussi repr√©senter une personne m√©chante et hypocrite. Le consultant devra se m√©fier des personnes de son entourage car cette carte annonce une trahison, de la m√©disance, de la jalousie. Elle peut aussi repr√©senter la solitude et l'isolement.", keywords: ["trahison", "m√©chancet√©", "jalousie", "solitude"], theme: "Personnage", vibe: "negative" },
            'Valet de Pique': { meaning: "Repr√©sente une personne mal intentionn√©e, un tra√Ætre, un jaloux, un m√©disant. Le consultant devra se m√©fier des personnes de son entourage. Cette carte annonce des ennuis, des contrari√©t√©s, des obstacles.", keywords: ["tra√Ætre", "ennuis", "obstacle", "jaloux"], theme: "Personnage", vibe: "negative" },
            '10 de Pique': { meaning: "Est une carte tr√®s n√©gative, elle annonce une √©preuve, un chagrin, des larmes. Elle peut √©galement annoncer un emprisonnement, la malchance. Le consultant devra faire face √† des difficult√©s.", keywords: ["√©preuve", "chagrin", "larmes", "malchance"], theme: "Difficult√©", vibe: "negative" },
            '9 de Pique': { meaning: "Annonce un √©chec, un retard, un deuil, la fatalit√©. C'est une carte de solitude, de tristesse, d'√©preuve. Le consultant devra faire face √† des moments difficiles.", keywords: ["√©chec", "deuil", "fatalit√©", "solitude", "tristesse"], theme: "Difficult√©", vibe: "negative" },
            '8 de Pique': { meaning: "Annonce une grosse fatigue, des soucis, une contrari√©t√©, un chagrin. Le consultant peut recevoir une nouvelle d√©primante. Cette carte est souvent associ√©e √† la maladie.", keywords: ["fatigue", "soucis", "maladie", "chagrin"], theme: "Difficult√©", vibe: "negative" },
            '7 de Pique': { meaning: "Annonce un l√©ger souci, une petite contrari√©t√©, des larmes passag√®res. Le consultant devra faire face √† des petits tracas qui ne dureront pas dans le temps.", keywords: ["souci", "l√©ger", "contrari√©t√©", "passager"], theme: "Difficult√©", vibe: "negative" },
            '6 de Pique': { meaning: "Annonce une am√©lioration, une √©volution lente, un apaisement. Apr√®s une p√©riode difficile, le consultant verra sa situation s'am√©liorer. C'est une carte d'espoir.", keywords: ["am√©lioration", "espoir", "apaisement", "√©volution"], theme: "√âtat d'esprit", vibe: "positive" },
            '5 de Pique': { meaning: "Annonce des difficult√©s, un √©chec, une perte, un proc√®s. Le consultant devra faire face √† des obstacles qui viendront perturber ses projets.", keywords: ["difficult√©s", "√©chec", "perte", "proc√®s"], theme: "Difficult√©", vibe: "negative" },
            '4 de Pique': { meaning: "Annonce des petits soucis de sant√©, une fatigue, un repos. Le consultant devra prendre soin de lui et se reposer. Cette carte peut √©galement annoncer un isolement.", keywords: ["sant√©", "fatigue", "repos", "isolement"], theme: "Difficult√©", vibe: "negative" },
            '3 de Pique': { meaning: "Annonce une contrari√©t√©, un √©loignement, une rupture. Le consultant devra faire face √† des difficult√©s dans le domaine sentimental ou amical.", keywords: ["rupture", "√©loignement", "contrari√©t√©"], theme: "Difficult√©", vibe: "negative" },
            '2 de Pique': { meaning: "Annonce une rivalit√©, une dualit√©, une opposition, une s√©paration. Le consultant devra faire face √† des conflits, des disputes.", keywords: ["rivalit√©", "s√©paration", "conflit", "opposition"], theme: "Difficult√©", vibe: "negative" }
        }},
        clubs: { name: 'Tr√®fles', cards: { 
            'As de Tr√®fle': { meaning: "Est une carte tr√®s positive, elle annonce le triomphe, la r√©ussite, le succ√®s. C'est l'aboutissement heureux d'un projet. Elle est √©galement synonyme de chance, de gain, de rentr√©e d'argent.", keywords: ["succ√®s", "triomphe", "chance", "gain"], theme: "Financier", vibe: "positive" },
            'Roi de Tr√®fle': { meaning: "Est un homme de confiance, il est honn√™te et travailleur. Il peut repr√©senter le p√®re, le mari, un ami sinc√®re. C'est un appui important, il apporte son soutien et sa protection.", keywords: ["homme", "confiance", "travailleur", "appui"], theme: "Personnage", vibe: "positive" },
            'Dame de Tr√®fle': { meaning: "Est une femme de confiance, elle est douce et honn√™te. Elle peut repr√©senter la m√®re, la femme, une amie sinc√®re. C'est un appui important, elle apporte son soutien et sa protection.", keywords: ["femme", "confiance", "honn√™te", "soutien"], theme: "Personnage", vibe: "positive" },
            'Valet de Tr√®fle': { meaning: "Est un jeune homme brun, il est serviable et sympathique. Il peut repr√©senter un √©tudiant, un apprenti. Il annonce une proposition int√©ressante, un projet qui se concr√©tise.", keywords: ["jeune homme", "proposition", "projet", "√©tudiant"], theme: "Personnage", vibe: "positive" },
            '10 de Tr√®fle': { meaning: "Cette carte est excellente, elle annonce une rentr√©e d'argent importante, une grosse somme. Elle peut repr√©senter un gain aux jeux, un h√©ritage. Elle annonce √©galement une grande r√©ussite professionnelle, une promotion et une augmentation de salaire.", keywords: ["argent", "gain", "promotion", "r√©ussite"], theme: "Financier", vibe: "positive" },
            '9 de Tr√®fle': { meaning: "Annonce une r√©ussite, un petit gain, l'aboutissement d'un projet. C'est une carte tr√®s positive qui annonce le succ√®s.", keywords: ["r√©ussite", "gain", "succ√®s", "projet"], theme: "Financier", vibe: "positive" },
            '8 de Tr√®fle': { meaning: "Repr√©sente une jeune fille brune. Elle annonce des d√©marches dans le domaine professionnel. Elle peut √©galement repr√©senter une rencontre amicale.", keywords: ["jeune fille", "d√©marche", "professionnel", "rencontre"], theme: "Personnage", vibe: "positive" },
            '7 de Tr√®fle': { meaning: "Annonce une r√©ussite, un succ√®s, la chance. Elle peut √©galement annoncer un petit gain d'argent. C'est une carte tr√®s positive.", keywords: ["r√©ussite", "chance", "gain", "succ√®s"], theme: "Financier", vibe: "positive" },
            '6 de Tr√®fle': { meaning: "Annonce la stabilit√©, l'√©quilibre. Le consultant verra sa situation s'am√©liorer et se stabiliser. C'est une carte tr√®s positive.", keywords: ["stabilit√©", "√©quilibre", "am√©lioration"], theme: "√âtat d'esprit", vibe: "positive" },
            '5 de Tr√®fle': { meaning: "Annonce des obstacles, des rivalit√©s, des conflits. Le consultant devra faire face √† des difficult√©s. Cette carte peut √©galement annoncer un proc√®s.", keywords: ["obstacle", "rivalit√©", "conflit", "proc√®s"], theme: "Difficult√©", vibe: "negative" },
            '4 de Tr√®fle': { meaning: "Annonce la r√©ussite, l'aboutissement heureux d'un projet. C'est la consolidation, la construction. C'est une carte tr√®s positive.", keywords: ["r√©ussite", "consolidation", "construction", "projet"], theme: "Professionnel", vibe: "positive" },
            '3 de Tr√®fle': { meaning: "Annonce la r√©ussite, le succ√®s, la promotion, l'√©l√©vation. Le consultant verra ses efforts r√©compens√©s. C'est une carte tr√®s positive.", keywords: ["r√©ussite", "promotion", "succ√®s", "√©l√©vation"], theme: "Professionnel", vibe: "positive" },
            '2 de Tr√®fle': { meaning: "Annonce une association, un duo, une collaboration, un soutien. Le consultant ne sera pas seul pour faire face aux difficult√©s.", keywords: ["association", "soutien", "collaboration", "duo"], theme: "Professionnel", vibe: "positive" }
        }}
    };

    let allCardsData = [];
    let currentFlashcard = null;
    let sprintTimerInterval;

    // --- INITIALISATION DE L'APPLICATION ---
    document.addEventListener('DOMContentLoaded', () => {
        initializeCardData(); 
        initializeUI();
    });

    function initializeUI() {
        showSection('apprentissage');
        newFlashcard();
        populateLibrary();
        populateTirageSelection();
        document.addEventListener('keydown', (event) => { if (event.key === "Escape") closeModal(); });
    }

    // *** CODE SP√âCIFIQUE AU JEU DE CARTES "FANTASTIQUE" ***
    function initializeCardData() {
        allCardsData = [];
        const baseURL = "cards/"; // Le dossier sur votre GitHub o√π vous avez upload√© les images
        const valueToFileName = {
            'A': 'A', '2': '2', '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9', '10': '10',
            'V': 'J', 'D': 'Q', 'R': 'K'
        };
        const suitToFileName = { 'C≈ìurs': 'Hearts', 'Carreaux': 'Diamonds', 'Piques': 'Spades', 'Tr√®fles': 'Clubs' };

        for (const suitKey in cardData) {
            const suitInfo = cardData[suitKey];
            const suitDetails = Object.values(SUITS).find(s => s.name === suitInfo.name);

            for (const cardName in suitInfo.cards) {
                const cardDetails = suitInfo.cards[cardName];
                const valueAndSuit = cardName.replace('As de ', 'A de ').replace('Roi de ', 'R de ').replace('Dame de ', 'D de ').replace('Valet de ', 'V de ').split(' de ');
                const value = valueAndSuit[0];
                
                const valuePart = valueToFileName[value];
                const suitPart = suitToFileName[suitInfo.name];
                // Construit le nom de fichier : ex: "Clubs_K.png"
                const imageSrc = `${baseURL}${suitPart}_${valuePart}.png`;

                allCardsData.push({
                    id: `${suitDetails.symbol}${value}`, suitSymbol: suitDetails.symbol, suitName: suitInfo.name, 
                    value: value, name: cardName, meaning: cardDetails.meaning,
                    imageSrc: imageSrc,
                    keywords: cardDetails.keywords || [], theme: cardDetails.theme || 'Inconnu', vibe: cardDetails.vibe || 'neutre'
                });
            }
        }
    }
    
    // --- Le reste de votre code Javascript est inchang√© ---
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelector(`.nav-tab[onclick="showSection('${sectionId}')"]`).classList.add('active');
        if (sprintTimerInterval) clearInterval(sprintTimerInterval); 
        if (sectionId === 'bibliotheque') populateLibrary();
        if (sectionId === 'tirage') { clearTirage(); }
        if (sectionId === 'entrainement') {
            document.getElementById('entrainement-hub').style.display = 'block';
            document.getElementById('game-area').classList.remove('active');
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showToast(message) {
        const toast = document.getElementById('toast-notification');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    const flashcardEl = document.getElementById('flashcard');
    const flashcardMeaningDetailsEl = document.getElementById('flashcard-meaning-details');
    const flashcardMeaningNameEl = document.getElementById('flashcard-meaning-name');
    const flashcardMeaningTextEl = document.getElementById('flashcard-meaning-text');
    const personalNotesTextarea = document.getElementById('personal-notes');

    function newFlashcard() {
        if (allCardsData.length === 0) return;
        currentFlashcard = allCardsData[Math.floor(Math.random() * allCardsData.length)];
        displayFlashcard();
        flashcardMeaningDetailsEl.classList.remove('visible'); 
    }

    function displayFlashcard() {
        if (!currentFlashcard) return;
        flashcardEl.style.backgroundImage = `url('${currentFlashcard.imageSrc}')`;
        flashcardMeaningNameEl.textContent = currentFlashcard.name;
        flashcardMeaningTextEl.textContent = currentFlashcard.meaning;
        personalNotesTextarea.value = localStorage.getItem(`notes_${currentFlashcard.id}`) || "";
    }

    function toggleMeaning() { if (currentFlashcard) flashcardMeaningDetailsEl.classList.toggle('visible'); }
    function saveNotes() {
        if (currentFlashcard) {
            localStorage.setItem(`notes_${currentFlashcard.id}`, personalNotesTextarea.value);
            showToast("Notes sauvegard√©es !");
        }
    }

    const hubEl = document.getElementById('entrainement-hub');
    const gameAreaEl = document.getElementById('game-area');

    function startGame(mode) {
        hubEl.style.display = 'none';
        gameAreaEl.innerHTML = ''; 
        gameAreaEl.classList.add('active');
        const backButton = `<div class="buttons-group"><button class="btn secondary" onclick="showSection('entrainement')">Retour au menu</button></div>`;
        
        if (mode === 'keyword') setupKeywordGame(backButton);
        if (mode === 'thematic') setupThematicSortGame(backButton);
        if (mode === 'sprint') setupSprintGame(backButton);
        if (mode === 'family') setupFamilySortGame(backButton);
        if (mode === 'classic') setupClassicQuiz(backButton);
    }

    function normalizeText(text) {
        return text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[,'".-]/g, ' ').trim();
    }

    function setupKeywordGame(backButton) {
        const card = allCardsData[Math.floor(Math.random() * allCardsData.length)];
        gameAreaEl.innerHTML = `
            <div class="playing-card game-card-display" style="background-image: url('${card.imageSrc}')"></div>
            <p class="game-question">Tapez un ou deux mots-cl√©s pour cette carte :</p>
            <input type="text" id="keyword-input" class="keyword-input" placeholder="Ex: amour, r√©ussite...">
            <div class="buttons-group"><button class="btn" id="keyword-submit">Valider</button></div>
            <div id="game-feedback" class="game-feedback"></div>
            ${backButton}
        `;
        document.getElementById('keyword-submit').onclick = () => checkKeywords(card);
        document.getElementById('keyword-input').onkeydown = (e) => { if(e.key === 'Enter') checkKeywords(card); };
    }

    function checkKeywords(card) {
        const inputEl = document.getElementById('keyword-input');
        const feedbackEl = document.getElementById('game-feedback');
        const userKeywords = normalizeText(inputEl.value).split(/\s+/).filter(k => k.length > 2);
        
        if (userKeywords.length === 0) {
            feedbackEl.textContent = "Veuillez entrer au moins un mot.";
            feedbackEl.className = 'game-feedback incorrect';
            return;
        }

        const cardKeywords = card.keywords;
        const match = userKeywords.some(uk => cardKeywords.some(ck => ck.includes(uk) || uk.includes(ck)));

        document.getElementById('keyword-submit').disabled = true;
        inputEl.disabled = true;

        if (match) {
            feedbackEl.textContent = `Correct ! Mots-cl√©s : ${card.keywords.join(', ')}.`;
            feedbackEl.className = 'game-feedback correct';
            setTimeout(() => startGame('keyword'), 2500);
        } else {
            feedbackEl.textContent = `Incorrect. Mots-cl√©s : ${card.keywords.join(', ')}.`;
            feedbackEl.className = 'game-feedback incorrect';
            setTimeout(() => startGame('keyword'), 3500);
        }
    }

    function setupThematicSortGame(backButton) {
        const themes = [...new Set(allCardsData.map(c => c.theme))];
        const correctTheme = themes[Math.floor(Math.random() * themes.length)];
        const card = allCardsData.filter(c => c.theme === correctTheme).sort(() => .5 - Math.random())[0];
        
        let options = [];
        let wrongThemes = themes.filter(t => t !== correctTheme).sort(() => .5 - Math.random());
        options.push({ text: correctTheme, correct: true });
        for(let i=0; i < 3; i++) {
            if(wrongThemes[i]) options.push({ text: wrongThemes[i], correct: false });
        }
        options.sort(() => .5 - Math.random());
        
        let optionsHTML = options.map(opt => `<button class="btn game-option-btn" onclick="checkThematicAnswer(this, ${opt.correct}, '${correctTheme}')">${opt.text}</button>`).join('');

        gameAreaEl.innerHTML = `
            <div class="playing-card game-card-display" style="background-image: url('${card.imageSrc}')"></div>
            <p class="game-question">Quel est le th√®me principal de cette carte ?</p>
            <div class="game-options-grid">${optionsHTML}</div>
            <div id="game-feedback" class="game-feedback"></div>
            ${backButton}
        `;
    }

    function checkThematicAnswer(element, isCorrect, correctTheme) {
        document.querySelectorAll('.game-option-btn').forEach(btn => {
            btn.disabled = true;
            btn.style.setProperty('box-shadow', 'var(--neumorphic-shadow-inset)');
        });
        const feedbackEl = document.getElementById('game-feedback');
        if (isCorrect) {
            element.style.setProperty('color', 'var(--green-color)');
            feedbackEl.textContent = "Correct !";
            feedbackEl.className = 'game-feedback correct';
        } else {
            element.style.setProperty('color', 'var(--red-color)');
            feedbackEl.textContent = `Incorrect. Le th√®me √©tait : ${correctTheme}.`;
            feedbackEl.className = 'game-feedback incorrect';
        }
        setTimeout(() => startGame('thematic'), 2500);
    }

    function setupSprintGame(backButton) {
        let timeLeft = 30;
        let score = 0;
        
        gameAreaEl.innerHTML = `
            <div class="sprint-timer" id="sprint-timer">${timeLeft}</div>
            <div class="sprint-score" id="sprint-score">Score: ${score}</div>
            <div class="playing-card game-card-display" id="sprint-card"></div>
            <div class="game-options-grid">
                <button class="btn game-option-btn" id="sprint-positive">Positif / Neutre</button>
                <button class="btn game-option-btn" id="sprint-negative">N√©gatif</button>
            </div>
            ${backButton}
        `;
        const timerEl = document.getElementById('sprint-timer');
        sprintTimerInterval = setInterval(() => {
            timeLeft--;
            timerEl.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(sprintTimerInterval);
                gameAreaEl.innerHTML = `<h2 class="section-title">Temps √©coul√© !</h2><p class="game-question">Votre score final est de ${score}.</p>${backButton}`;
            }
        }, 1000);
        loadSprintQuestion(score);
    }

    function loadSprintQuestion(currentScore) {
        const card = allCardsData[Math.floor(Math.random() * allCardsData.length)];
        document.getElementById('sprint-card').style.backgroundImage = `url('${card.imageSrc}')`;
        document.getElementById('sprint-score').textContent = `Score: ${currentScore}`;
        document.getElementById('sprint-positive').onclick = () => checkSprintAnswer(card.vibe !== 'negative', currentScore);
        document.getElementById('sprint-negative').onclick = () => checkSprintAnswer(card.vibe === 'negative', currentScore);
    }
    function checkSprintAnswer(isCorrect, score) {
        if (isCorrect) {
            score++;
            loadSprintQuestion(score);
        } else {
            const cardEl = document.getElementById('sprint-card');
            cardEl.style.borderColor = 'var(--red-color)';
            setTimeout(() => { cardEl.style.borderColor = '#fff'; }, 200);
            loadSprintQuestion(score); 
        }
    }

    let familyGameState = {};
    function setupFamilySortGame(backButton) {
        const randomValue = VALUES[Math.floor(Math.random() * VALUES.length)];
        const familyCards = allCardsData.filter(c => c.value === randomValue);
        const shuffledMeanings = [...familyCards].sort(() => .5 - Math.random());

        let cardsHTML = familyCards.map(c => `<div class="family-card" id="card-${c.id}" style="background-image: url('${c.imageSrc}')" onclick="selectFamilyCard('${c.id}')"></div>`).join('');
        let meaningsHTML = shuffledMeanings.map(c => `<div class="quiz-option" id="mean-${c.id}" onclick="selectFamilyMeaning('${c.id}')">${c.meaning}</div>`).join('');
        
        gameAreaEl.innerHTML = `
            <p class="game-question">Associez chaque carte de valeur "${VALUE_NAMES[randomValue] || randomValue}" √† sa signification.</p>
            <div class="family-grid">${cardsHTML}</div>
            <div class="family-meanings-list">${meaningsHTML}</div>
            <div id="game-feedback" class="game-feedback"></div>
            ${backButton}
        `;
        familyGameState = { selectedCard: null, selectedMeaning: null };
    }

    function selectFamilyCard(cardId) {
        if (document.getElementById(`card-${cardId}`).classList.contains('matched')) return;
        familyGameState.selectedCard = cardId;
        document.querySelectorAll('.family-card').forEach(c => c.classList.remove('selected'));
        document.getElementById(`card-${cardId}`).classList.add('selected');
        checkFamilyMatch();
    }

    function selectFamilyMeaning(cardId) {
        if (document.getElementById(`mean-${cardId}`).classList.contains('matched')) return;
        familyGameState.selectedMeaning = cardId;
        document.querySelectorAll('.family-meanings-list .quiz-option').forEach(m => m.classList.remove('selected'));
        document.getElementById(`mean-${cardId}`).classList.add('selected');
        checkFamilyMatch();
    }

    function checkFamilyMatch() {
        if (familyGameState.selectedCard && familyGameState.selectedMeaning) {
            const feedbackEl = document.getElementById('game-feedback');
            if (familyGameState.selectedCard === familyGameState.selectedMeaning) {
                feedbackEl.textContent = "Correct !";
                feedbackEl.className = 'game-feedback correct';
                document.getElementById(`card-${familyGameState.selectedCard}`).classList.add('matched');
                document.getElementById(`mean-${familyGameState.selectedMeaning}`).classList.add('matched');
                
                if(document.querySelectorAll('.family-card.matched').length === 4) {
                    feedbackEl.textContent = "Famille compl√©t√©e ! Bravo !";
                    setTimeout(() => startGame('family'), 2500);
                }
            } else {
                feedbackEl.textContent = "Incorrect, essayez une autre combinaison.";
                feedbackEl.className = 'game-feedback incorrect';
            }
            familyGameState.selectedCard = null;
            familyGameState.selectedMeaning = null;
            setTimeout(() => {
                document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
                if (feedbackEl.textContent.startsWith("Incorrect")) feedbackEl.textContent = "";
            }, 1500);
        }
    }

    function setupClassicQuiz(backButton) {
        let optionsHTML = `
            <button class="btn tirage-select-btn" onclick="startClassicQuizMode('meaningToCard')"><h3>Signification ‚ûî Carte</h3></button>
            <button class="btn tirage-select-btn" onclick="startClassicQuizMode('cardToMeaning')"><h3>Carte ‚ûî Signification</h3></button>
        `;
        gameAreaEl.innerHTML = `<p class="game-question">Choisissez un mode de quiz :</p><div class="buttons-group" style="flex-direction: column;">${optionsHTML}</div>${backButton}`;
    }

    function startClassicQuizMode(type) {
        const card = allCardsData[Math.floor(Math.random() * allCardsData.length)];
        const wrongCards = allCardsData.filter(c => c.id !== card.id).sort(() => .5-Math.random());
        let options = [], questionText = "";

        if (type === 'cardToMeaning') {
            questionText = `Quelle est la signification de : ${card.name} ?`;
            options.push({ text: card.meaning, correct: true });
            for(let i=0; i < 3; i++) options.push({ text: wrongCards[i].meaning, correct: false });
        } else {
            questionText = `Quelle carte signifie : "${card.meaning.substring(0, 120)}..." ?`;
            options.push({ text: card.name, correct: true });
            for(let i=0; i < 3; i++) options.push({ text: wrongCards[i].name, correct: false });
        }
        options.sort(() => .5 - Math.random());
        
        let optionsHTML = options.map(opt => `<div class="quiz-option" onclick="checkClassicAnswer(this, ${opt.correct}, '${type}')">${opt.text}</div>`).join('');
        gameAreaEl.innerHTML = `
            <p class="game-question">${questionText}</p>
            <div class="game-options-list">${optionsHTML}</div>
            <div id="game-feedback" class="game-feedback"></div>
            <div class="buttons-group"><button class="btn secondary" onclick="startGame('classic')">Retour</button></div>
        `;
    }

    function checkClassicAnswer(element, isCorrect, type) {
        document.querySelectorAll('.quiz-option').forEach(el => el.classList.add('disabled'));
        const feedbackEl = document.getElementById('game-feedback');
        if (isCorrect) {
            element.classList.add('correct');
            feedbackEl.textContent = "Correct !";
            feedbackEl.className = 'game-feedback correct';
        } else {
            element.classList.add('incorrect');
            feedbackEl.textContent = "Incorrect.";
            feedbackEl.className = 'game-feedback incorrect';
        }
        setTimeout(() => startClassicQuizMode(type), 2000);
    }
    
    const tirageTypes = {
        uneCarte: { name: "Guidance Unique", description: "Une carte pour une inspiration ou une r√©ponse concise.", numCards: 1, positions: ["Votre guidance du moment"] },
        troisCartesPPF: { name: "Pass√©, Pr√©sent, Futur", description: "Un aper√ßu de l'√©volution d'une situation.", numCards: 3, positions: ["Le Pass√©", "Le Pr√©sent", "Le Futur Potentiel"] },
        relationnel: { name: "Dynamique Relationnelle", description: "√âclairage sur une relation.", numCards: 3, positions: ["Vous", "L'autre personne", "La dynamique"] }
    };
    const tirageSelectionGridEl = document.getElementById('tirage-selection-grid');
    const cardsSpreadAreaEl = document.getElementById('cards-spread-area');
    const tirageInterpretationAreaEl = document.getElementById('tirage-interpretation-area');
    const tirageInterpretationTextEl = document.getElementById('tirage-interpretation-text');
    const tirageSynthesisTextEl = document.getElementById('tirage-synthesis-text');
    const clearTirageBtn = document.getElementById('clear-tirage-btn');
    
    function populateTirageSelection() {
        tirageSelectionGridEl.innerHTML = '';
        for (const key in tirageTypes) {
            const type = tirageTypes[key];
            const btn = document.createElement('button');
            btn.className = 'btn tirage-select-btn';
            btn.innerHTML = `<h3>${type.name}</h3><p>${type.description}</p>`;
            btn.onclick = () => performTirage(key);
            tirageSelectionGridEl.appendChild(btn);
        }
    }
    
    function performTirage(tirageKey) {
        clearTirage(true);
        const tirageSetup = tirageTypes[tirageKey];
        if (!tirageSetup) return;
        let availableCards = [...allCardsData].sort(() => 0.5 - Math.random());
        let drawnCardsDetails = [];
        for (let i = 0; i < tirageSetup.numCards; i++) {
            const card = availableCards[i];
            const positionName = tirageSetup.positions[i];
            drawnCardsDetails.push({ card, positionName });
            const cardItemWrapper = document.createElement('div');
            cardItemWrapper.className = 'spread-card-item';
            cardItemWrapper.innerHTML = `
                <div class="drawn-card-display" style="background-image: url('${card.imageSrc}')" onclick="showCardDetailsInModal(allCardsData.find(c => c.id === '${card.id}'))"></div>
                <div class="card-position-label">${positionName}</div>
            `;
            cardsSpreadAreaEl.appendChild(cardItemWrapper);
        }
        generateTirageInterpretation(drawnCardsDetails, tirageSetup.name);
        clearTirageBtn.style.display = 'inline-block';
        tirageSelectionGridEl.style.display = 'none';
    }

    function generateTirageInterpretation(drawnCardsDetails, tirageName) {
        let interpretationHTML = "";
        drawnCardsDetails.forEach(detail => {
            interpretationHTML += `<div style="margin-bottom: 15px;"><strong>${detail.positionName} (${detail.card.name}):</strong><br><span style="color:var(--text-color-light);">${detail.card.meaning}</span></div>`;
        });
        tirageInterpretationTextEl.innerHTML = interpretationHTML;
        
        let positiveVibes = drawnCardsDetails.filter(d => d.card.vibe === 'positive').length;
        let negativeVibes = drawnCardsDetails.filter(d => d.card.vibe === 'negative').length;
        let synthesis = "Analyse globale : ";
        if (positiveVibes > negativeVibes) synthesis += "le tirage penche vers une √©nergie majoritairement positive.";
        else if (negativeVibes > positiveVibes) synthesis += "le tirage indique la pr√©sence de d√©fis ou d'√©nergies n√©gatives √† consid√©rer.";
        else synthesis += "l'√©nergie du tirage est √©quilibr√©e, m√™lant d√©fis et opportunit√©s.";
        tirageSynthesisTextEl.textContent = synthesis;
        
        tirageInterpretationAreaEl.querySelector('h3').textContent = `Interpr√©tation du Tirage "${tirageName}"`;
        tirageInterpretationAreaEl.style.display = 'block';
    }

    function clearTirage(isStartingNew = false) {
        tirageSelectionGridEl.style.display = 'flex';
        cardsSpreadAreaEl.innerHTML = '';
        tirageInterpretationAreaEl.style.display = 'none';
        clearTirageBtn.style.display = 'none';
        if (!isStartingNew) populateTirageSelection();
    }
    
    const cardLibraryGridEl = document.getElementById('card-library-grid');
    const modalEl = document.getElementById('card-detail-modal');
    const modalCardDisplay = document.getElementById('modal-playing-card');
    const modalCardNameEl = document.getElementById('modal-card-name');
    const modalCardMeaningEl = document.getElementById('modal-card-meaning');
    const modalCardNotesEl = document.getElementById('modal-card-notes');
    
    function populateLibrary() {
        cardLibraryGridEl.innerHTML = ''; 
        const suitDisplayOrder = ['CLUBS', 'HEARTS', 'SPADES', 'DIAMONDS']; 
        let sortedCards = [...allCardsData].sort((a,b) => { 
            const suitAKey = Object.keys(SUITS).find(key => SUITS[key].name === a.suitName);
            const suitBKey = Object.keys(SUITS).find(key => SUITS[key].name === b.suitName);
            const indexA = suitDisplayOrder.indexOf(suitAKey);
            const indexB = suitDisplayOrder.indexOf(suitBKey);
            if (indexA !== indexB) return indexA - indexB;
            return VALUES.indexOf(a.value) - VALUES.indexOf(b.value);
        });

        sortedCards.forEach(card => {
            const libraryCardEl = document.createElement('div');
            libraryCardEl.className = 'library-card';
            libraryCardEl.style.backgroundImage = `url('${card.imageSrc}')`;
            libraryCardEl.setAttribute('aria-label', card.name);
            libraryCardEl.onclick = () => showCardDetailsInModal(card);
            cardLibraryGridEl.appendChild(libraryCardEl);
        });
    }
    
    function showCardDetailsInModal(card) {
        if (!card) return;
        modalCardDisplay.style.backgroundImage = `url('${card.imageSrc}')`;
        modalCardNameEl.textContent = card.name;
        modalCardMeaningEl.textContent = card.meaning;
        modalCardNotesEl.textContent = localStorage.getItem(`notes_${card.id}`) || "Aucune note personnelle pour cette carte.";
        modalEl.style.display = 'flex'; 
        document.body.style.overflow = 'hidden'; 
    }

    function closeModal() {
        modalEl.style.display = 'none';
        document.body.style.overflow = ''; 
    }
    function closeModalOnClickOutside(event) {
        if (event.target === modalEl) closeModal();
    }
</script>
</body>
</html>